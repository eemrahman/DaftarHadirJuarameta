<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daftar Hadir</title>
    <link rel="stylesheet" href="styles.css">
    <script>
        const scriptURL = "https://script.google.com/macros/s/AKfycbxwVGTK2nsGnxO3P2VBXwc0EVbLg_W_4O5nuxbhbB4Mc9pLHA89dVb6iMr8M_Fja61LGA/exec"; // Ganti dengan Deployment URL dari Apps Script
        let latitude = null, longitude = null;

        function requestLocation() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        latitude = position.coords.latitude;
                        longitude = position.coords.longitude;
                        document.getElementById("lokasi-status").innerText = `ğŸ“ Lokasi: ${latitude}, ${longitude}`;
                        document.getElementById("lokasi-status").classList.add("success");
                    },
                    (error) => {
                        alert("Gagal mendapatkan lokasi: " + error.message);
                        document.getElementById("lokasi-status").innerText = "âš ï¸ Lokasi tidak tersedia";
                        document.getElementById("lokasi-status").classList.add("error");
                    }
                );
            } else {
                alert("Perangkat tidak mendukung GPS.");
            }
        }

        function submitForm() {
            const nama = document.getElementById("nama").value;
            const status = document.getElementById("status").value;

            if (!nama || !status) {
                alert("Harap isi semua data!");
                return;
            }

            if (latitude === null || longitude === null) {
                alert("Harap izinkan lokasi terlebih dahulu!");
                return;
            }

            fetch(scriptURL, {
                method: "POST",
                body: new URLSearchParams({ nama, status, latitude, longitude }),
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
            })
            .then(response => response.text())
            .then(() => {
                alert("âœ… Data berhasil dikirim!");
                document.getElementById("nama").value = "";
                document.getElementById("status").value = "";
                loadData();
            })
            .catch(error => console.error("Error:", error));
        }

        function loadData() {
            fetch(scriptURL)
                .then(response => response.json())
                .then(data => {
                    let tableContent = `<tr>
                        <th>Timestamp</th>
                        <th>Nama</th>
                        <th>Status</th>
                        <th>Lokasi</th>
                        <th>Aksi</th>
                    </tr>`;

                    data.slice(1).forEach(row => {
                        tableContent += `<tr>
                            <td>${row[0]}</td>
                            <td>${row[1]}</td>
                            <td>${row[2]}</td>
                            <td>ğŸ“ ${row[3]}, ${row[4]}</td>
                            <td><button class="btn-map" onclick="openMap(${row[3]}, ${row[4]})">Lihat Lokasi</button></td>
                        </tr>`;
                    });

                    document.getElementById("dataTable").innerHTML = tableContent;
                })
                .catch(error => console.error("Error:", error));
        }

        function openMap(lat, lon) {
            window.open(`https://www.google.com/maps?q=${lat},${lon}`, "_blank");
        }

        window.onload = loadData;
    </script>
</head>
<body>
    <div class="container">
        <h2>ğŸ“‹ Daftar Hadir</h2>

        <button class="btn-location" onclick="requestLocation()">ğŸ“ Izinkan Lokasi</button>
        <p id="lokasi-status" class="status-text">âš ï¸ Lokasi belum diizinkan</p>

        <div class="form-group">
            <input type="text" id="nama" placeholder="ğŸ“ Nama">
            <select id="status">
                <option value="">ğŸ“Œ Pilih Status</option>
                <option value="Hadir">âœ… Hadir</option>
                <option value="Tidak Hadir">âŒ Tidak Hadir</option>
                <option value="Sakit">ğŸ¤’ Sakit</option>
            </select>
            <button class="btn-submit" onclick="submitForm()">ğŸ“¨ Kirim</button>
        </div>

        <h3>ğŸ“Š Data Kehadiran</h3>
        <table id="dataTable"></table>
    </div>
</body>
</html>
